# Playwright MCP Server

## Overview
Playwright MCP Server is a .NET 8 library that exposes Playwright browser automation capabilities as Model Context Protocol (MCP) tools. It targets `net8.0`, enables nullable reference types, and depends on the official `Microsoft.Playwright` SDK.【F:PlaywrightMcpServer/PlaywrightMcpServer.csproj†L1-L9】 The server builds without the upstream MCP SDK by providing minimal attribute stubs that decorate the tool host and individual tool methods.【F:PlaywrightMcpServer/ModelContextProtocolStubs.cs†L5-L43】 All tool implementations live in the partial `PlaywrightTools` class, which is registered as an MCP tool provider and seeds metadata describing the core browser actions that it supports.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L14-L44】【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L422-L422】

## Directory structure
- `Actions/` – Partial definitions of `PlaywrightTools` that implement concrete MCP tools for navigation, input, diagnostics, and media capture. For example, navigation helpers wrap `page.goto`/`goBack`, console tools surface captured console logs, network tools summarize requests, and screenshot helpers capture page or element images and attach them to the response.【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Navigate.cs†L13-L99】【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Console.cs†L12-L44】【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Network.cs†L13-L66】【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Screenshot.cs†L15-L118】
- `Models/` – Serializable records that describe modal dialogs, console output, network traffic, downloads, snapshots, and tab descriptors used throughout the tooling APIs.【F:PlaywrightMcpServer/Models/BrowserModels.cs†L8-L80】
- `Responses/` – Response composition pipeline, including serialization, attachment handling, configuration knobs, and a parser that reconstructs structured data from rendered Markdown sections.【F:PlaywrightMcpServer/Responses/Response.cs†L9-L200】【F:PlaywrightMcpServer/Responses/ResponseContent.cs†L5-L34】【F:PlaywrightMcpServer/Responses/ResponseConfiguration.cs†L6-L26】【F:PlaywrightMcpServer/Responses/ResponseParser.cs†L7-L88】
- `Security/` – A secret redactor that replaces configured secret values with placeholders before responses are returned.【F:PlaywrightMcpServer/Security/SecretRedactor.cs†L6-L42】
- `Snapshots/` – Utilities for capturing accessibility snapshots and recent activity, then rendering Markdown sections for modal state, console output, downloads, network traffic, and page metadata.【F:PlaywrightMcpServer/Snapshots/SnapshotManager.cs†L8-L52】【F:PlaywrightMcpServer/Snapshots/SnapshotMarkdownBuilder.cs†L6-L84】【F:PlaywrightMcpServer/Snapshots/ModalStateMarkdownBuilder.cs†L5-L23】
- `Tabs/` – Lifecycle management for browser tabs/pages, including event subscription, activity buffering, and restoration metadata.【F:PlaywrightMcpServer/Tabs/TabManager.cs†L13-L167】【F:PlaywrightMcpServer/Tabs/TabManager.cs†L170-L399】
- `Tools/` – Core orchestration for Playwright process management, environment-driven configuration, tab activation, download/output paths, and tool metadata registration.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L17-L353】【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L339-L344】
- `ModelContextProtocolStubs.cs` – Local attribute shims for the MCP Server SDK.【F:PlaywrightMcpServer/ModelContextProtocolStubs.cs†L5-L43】

## Tool orchestration
`PlaywrightTools` centralizes browser startup, tool registry metadata, and helper utilities that child partial classes reuse. It keeps singletons for the current Playwright instance, browser, context, tab manager, snapshot manager, and response configuration. The static constructor registers built-in tool descriptors so metadata stays consistent across handlers.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L17-L44】 Environment variables tune execution, including `MCP_PLAYWRIGHT_HEADLESS`, `MCP_PLAYWRIGHT_DOWNLOADS_DIR`, `MCP_PLAYWRIGHT_VIDEOS_DIR`, and `MCP_PLAYWRIGHT_CHROMIUM_CHANNEL`, while helper methods resolve output directories for downloads, videos, screenshots, PDFs, and traces.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L46-L353】 The class also normalizes URLs, creates timestamped file names, and exposes `DescribeTabs` for clients that need tab metadata.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L323-L344】【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L334-L344】【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L402-L422】

`EnsureLaunchedAsync` bootstraps Playwright, launches the configured browser engine, provisions a context with download and video support, grants default permissions, and guarantees there is an active tab before delegating to tool handlers.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L117-L171】 Complementary helpers create fresh tabs, close the context, choose the correct browser channel, and locate elements by selector or snapshot references.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L174-L400】

## Browser and tab lifecycle
`TabManager` tracks every open Playwright page, keeps the active tab synchronized, and registers event handlers that buffer console messages, network traffic, modal dialogs, file chooser activity, and downloads. It can describe the current tab set, collect console errors, prepare restore plans, and dispose of closed tabs safely.【F:PlaywrightMcpServer/Tabs/TabManager.cs†L13-L167】 The `TabState` type wires Playwright events to rolling buffers, supports navigation helpers that wait for load states and downloads, and exposes helpers to resolve snapshot-backed ARIA references back to live locators.【F:PlaywrightMcpServer/Tabs/TabManager.cs†L170-L559】 Snapshot metadata feeds into `TabState.UpdateMetadata`, ensuring later tools can find prior accessibility trees or activity logs.【F:PlaywrightMcpServer/Tabs/TabManager.cs†L415-L555】

## Response pipeline
Every tool calls `ExecuteWithResponseAsync`, which wraps the handler in logging, error handling, and response serialization. Responses collect result text, emitted JavaScript snippets, tab inventories, images, and optional snapshots before serializing to structured content. Attachments default to images being included, but the configuration can omit blobs or entire snapshots. All output passes through the `SecretRedactor` so known secrets are replaced with placeholders.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L86-L115】【F:PlaywrightMcpServer/Responses/Response.cs†L22-L145】【F:PlaywrightMcpServer/Responses/ResponseContent.cs†L5-L34】【F:PlaywrightMcpServer/Responses/ResponseConfiguration.cs†L12-L25】【F:PlaywrightMcpServer/Security/SecretRedactor.cs†L6-L42】 For clients that need to rehydrate structured data from Markdown, `ResponseParser` reconstructs sections such as result, code, tabs, page state, console messages, modal state, and downloads from the serialized response.【F:PlaywrightMcpServer/Responses/ResponseParser.cs†L7-L88】

## Snapshots and diagnostics
When a tool opts into snapshots, `SnapshotManager` captures the current page title, URL, accessibility tree, latest console/network activity, modal dialogs, and download status, then updates the owning `TabState` with the resulting payload.【F:PlaywrightMcpServer/Snapshots/SnapshotManager.cs†L10-L43】 Snapshot Markdown combines modal guidance, console summaries, downloads, network requests, and page state in YAML form, while a dedicated builder formats modal entries to highlight which tool can clear them.【F:PlaywrightMcpServer/Snapshots/SnapshotMarkdownBuilder.cs†L8-L67】【F:PlaywrightMcpServer/Snapshots/ModalStateMarkdownBuilder.cs†L5-L22】 The model types in `BrowserModels` define the JSON shape of these diagnostics so callers can consume them programmatically if needed.【F:PlaywrightMcpServer/Models/BrowserModels.cs†L8-L69】

## Tool catalog
Tool implementations are grouped by concern across the partial classes. Navigation helpers cover URL changes and history traversal while logging the JS executed.【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Navigate.cs†L13-L99】 Diagnostics utilities surface console output and cumulative network traffic for the active tab.【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Console.cs†L12-L44】【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Network.cs†L13-L66】 Media tools take viewport or element screenshots, enforce argument validation (format, target, full-page rules), persist files to the configured shots directory, and inline thumbnails for quick inspection.【F:PlaywrightMcpServer/Actions/PlaywrightTools.Actions.Screenshot.cs†L15-L118】 Additional partial files (keyboard, mouse, input, forms, PDFs, tracing, waits, etc.) follow the same pattern: they validate arguments, execute Playwright APIs through shared helpers, add human-readable Markdown summaries, emit the JavaScript equivalent, and optionally attach media or snapshots.

## Extending the server
New tools can be added by creating another partial `PlaywrightTools` class inside `Actions/` and annotating methods with `McpServerTool`. Shared helpers—such as browser launch orchestration, tab resolution, locator lookup, response building, and metadata registration—ensure new handlers only need to focus on business logic. Adding a new tool descriptor via `RegisterTool` keeps the metadata registry in sync, while the local MCP attribute stubs make it possible to build and test without extra dependencies.【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L31-L44】【F:PlaywrightMcpServer/Tools/PlaywrightTools.cs†L339-L344】【F:PlaywrightMcpServer/ModelContextProtocolStubs.cs†L5-L43】
